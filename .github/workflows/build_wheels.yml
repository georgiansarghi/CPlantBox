name: build-wheels

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
  workflow_dispatch:

jobs:
  macos:
    name: macOS wheel (${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [macos-15, macos-26]
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Install system dependencies
        run: |
          brew update
          brew install sundials suite-sparse

      - name: Build wheel
        run: |
          ./scripts/macos/build/build-wheel.sh

      - name: Upload wheel artifact
        uses: actions/upload-artifact@v4
        with:
          name: cplantbox-macos-${{ matrix.os }}
          path: wheelhouse/macos/*.whl

  manylinux:
    name: manylinux wheel (x86_64)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Set up buildx
        uses: docker/setup-buildx-action@v3

      - name: Build manylinux wheels
        run: |
          ./scripts/manylinux/build/build-wheels.sh x86_64

      - name: Upload wheel artifact
        uses: actions/upload-artifact@v4
        with:
          name: cplantbox-manylinux-x86_64
          path: wheelhouse/linux/manylinux2014_x86_64/*.whl
